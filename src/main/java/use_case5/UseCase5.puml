@startuml
!theme plain
skinparam packageStyle rectangle

' Force vertical layered layout (top â†’ bottom)
top to bottom direction
left to right direction

package "External" {
  [UI]
}

package "Interface Adapters" {
  [BudgetController]
  [BudgetPresenter]
  [BudgetViewModel]
}

package "Use Cases" {
  [SetBudgetInteractor]
  [DeleteBudgetInteractor]
  [RefreshBudgetsInteractor]
  [BudgetSpentCalculator]
}

package "Boundary" {
  interface [SetBudgetInputBoundary]
  interface [DeleteBudgetInputBoundary]
  interface [RefreshBudgetsInputBoundary]

  interface [BudgetOutputBoundary]

  [BudgetResponseModel]
  [BudgetNotificationModel]
  [SetBudgetRequestModel]
}

package "Data" {
  interface [BudgetRepository]
  interface [TransactionDataAccessInterface]
  [InMemoryBudgetRepository]
  [BudgetEntity]
}

' ===== UI -> Controller =====
[UI] --> [BudgetController]

' ===== UI -> ViewModel =====
[UI] --> [BudgetViewModel]

' ===== Controller -> Input Boundaries =====
[BudgetController] --> [SetBudgetInputBoundary]
[BudgetController] --> [DeleteBudgetInputBoundary]
[BudgetController] --> [RefreshBudgetsInputBoundary]

' ===== Interactors implement their Input Boundaries =====
[SetBudgetInteractor] ..|> [SetBudgetInputBoundary]
[DeleteBudgetInteractor] ..|> [DeleteBudgetInputBoundary]
[RefreshBudgetsInteractor] ..|> [RefreshBudgetsInputBoundary]

' ===== Presenter implements Output Boundary =====
[BudgetPresenter] ..|> [BudgetOutputBoundary]

' ===== Interactors -> Presenter =====
[SetBudgetInteractor] --> [BudgetPresenter]
[DeleteBudgetInteractor] --> [BudgetPresenter]
[RefreshBudgetsInteractor] --> [BudgetPresenter]

' ===== Presenter -> ViewModel =====
[BudgetPresenter] --> [BudgetViewModel]

' ===== Interactors -> Data repositories =====
[SetBudgetInteractor] --> [BudgetRepository]
[DeleteBudgetInteractor] --> [BudgetRepository]
[RefreshBudgetsInteractor] --> [BudgetRepository]

' ===== Interactors using calculator =====
[SetBudgetInteractor] --> [BudgetSpentCalculator]
[RefreshBudgetsInteractor] --> [BudgetSpentCalculator]

' ===== Calculator -> TransactionDAO =====
[BudgetSpentCalculator] --> [TransactionDataAccessInterface]

' ===== Concrete Repo Implements Interface =====
[InMemoryBudgetRepository] ..|> [BudgetRepository]
[BudgetRepository] --> [BudgetEntity]

' ===== Data models =====
[SetBudgetInteractor] --> [SetBudgetRequestModel]
[SetBudgetInteractor] --> [BudgetResponseModel]
[SetBudgetInteractor] --> [BudgetNotificationModel]

[DeleteBudgetInteractor] --> [BudgetResponseModel]
[DeleteBudgetInteractor] --> [BudgetNotificationModel]

[RefreshBudgetsInteractor] --> [BudgetResponseModel]
[RefreshBudgetsInteractor] --> [BudgetNotificationModel]

' ===== Notes for Use Cases =====
note bottom of [SetBudgetInteractor]
  Use Case:
  - Create/Update a budget
  - Recalculate spending
  - Send UI and notification updates
end note

note bottom of [DeleteBudgetInteractor]
  Use Case:
  - Delete a budget
  - Send UI and notification updates
end note

note bottom of [RefreshBudgetsInteractor]
  Use Case:
  - Recalculate all budgets
  - Send UI and notification updates
end note

note bottom of [BudgetSpentCalculator]
  Domain Service:
  - Calculates monthly spending per category
end note

@enduml